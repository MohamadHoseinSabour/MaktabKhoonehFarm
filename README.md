# سیستم اتوماسیون انتقال دوره‌ها (ACMS)

سیستم اتوماسیون انتقال دوره‌ها (Automated Course Migration System - به اختصار ACMS) یک پلتفرم جامع برای استخراج داده‌های دوره‌های آموزشی، مدیریت لینک‌ها، دانلود و پردازش ویدیوها، ترجمه هوشمند زیرنویس‌ها به کمک هوش مصنوعی و ارائه داشبورد مدیریتی است.

## ابزارها و تکنولوژی‌ها (Stack)

- **بک‌اند (Backend):** FastAPI + SQLAlchemy + Celery + Redis
- **فرانت‌اند (Frontend):** Next.js 14 (App Router, TypeScript) + React 18
- **پایگاه داده (Database):** SQLite (پیش‌فرض) یا PostgreSQL

## امکانات و ویژگی‌های کلیدی

- استخراج اطلاعات و لینک‌های دوره‌ها (Scraping)
- دانلود و مدیریت فایل‌های دوره
- استخراج و پردازش زیرنویس‌ها
- ترجمه خودکار زیرنویس‌ها با استفاده از هوش مصنوعی (OpenAI / کلید API)
- اجرای پردازش‌ها در پس‌زمینه با Celery و قابلیت Fallback به پردازش محلی (در صورت عدم حضور Redis)
- داشبورد مدیریتی و رابط کاربری مدرن با Next.js
- نمایش لاگ‌های زنده محیط کاربری از طریق WebSockets

## ساختار پروژه

پروژه به دو بخش کلی معماری شده است:
- `backend/`: کدهای مربوط به وب سرویس، دیتابیس، مدل‌ها و تسک‌های غیرهمزمان.
- `frontend/`: پنل ادمین و داشبورد کاربری نوشته شده در قالب ریکت و نکست جی‌اس.

## راه‌اندازی سریع (Quick Start)

### اسکریپت اجرای خودکار (ویندوز)
برای راحت‌ترین شکل اجرای پروژه در محیط ویندوز، می‌توانید مستقیماً از فایل `run_latest.bat` در ریشه پروژه استفاده کنید. این فایل تغییرات گیت را دریافت کرده، وابستگی‌های نرم‌افزاری را نصب و فرانت‌اند و بک‌اند را برای شما اجرا می‌کند:

```bat
.\run_latest.bat
```
سپس داشبورد در `http://localhost:3000` در دسترس خواهد بود.

---

### راه‌اندازی دستی

#### ۱. تنظیم متغیرهای محیطی
ابتدا از روی فایل نمونه یک فایل محیطی جدید ایجاد کنید:
```bash
cp .env.example .env
```

#### ۲. راه‌اندازی بک‌اند
```bash
cd backend
python -m venv .venv

# فعال‌سازی در ویندوز:
.venv\Scripts\activate
# فعال‌سازی در لینوکس / مک:
# source .venv/bin/activate

pip install -r requirements.txt
uvicorn app.main:app --app-dir backend --host 0.0.0.0 --port 8000 --reload
```
با این کار، مستندات ای‌پی‌آی پروژه در آدرس `http://localhost:8000/docs` فعال می‌گردد.

#### ۳. راه‌اندازی فرانت‌اند
در یک ترمینال دیگر، در پوشه `frontend/` دستورات زیر را اجرا کنید:
```bash
cd frontend
npm install
npm run dev
```
با این کار، داشبورد در آدرس `http://localhost:3000` اجرا خواهد شد.

## مسیرهای مهم سرویس (Core API)

- `POST /api/courses/` : افزودن دوره جدید و قرار دادن فرایند Scrape در صف
- `POST /api/courses/{id}/links/` : بررسی و تطبیق لینک‌های یک دوره
- `POST /api/courses/{id}/process/` : ارسال عملیات پردازش و دانلود به صف
- `POST /api/courses/{id}/process-subtitles/` : ارسال پردازش زیرنویس به صف
- `POST /api/courses/{id}/ai-translate/` : درخواست ترجمه زیرنویس با هوش مصنوعی
- `GET /api/dashboard/stats/` : دریافت آمار کلی و یکپارچه داشبورد
- `GET /api/courses/{id}/progress/` : دریافت گزارش درصد پیشرفت دوره‌ها
- `WS /ws/courses/{id}/live-logs/` : ارتباط وب‌سوکت برای دریافت لاگ‌های زنده

## اجرای تست‌ها

برای اطمینان از صحت عملکرد بک‌اند می‌توانید آزمایش‌های (Tests) بک‌اند را با `pytest` اجرا کنید:
```bash
cd backend
pytest
```

## نکات توسعه و نگهداری

- در صورتی که Redis/Celery Worker در حال اجرا نباشد، سیستم به طور خودکار تسک‌ها را به صورت محلی و در پس‌زمینه (Background execution) پردازش خواهد کرد.
- کلیدهای ای‌پی‌آی هوش مصنوعی در پایگاه داده رمزنگاری می‌شوند (فیلد `ai_configs.api_key`).
- حالت خطایابی (Debug Mode) به صورت موقت فرایند دانلود فایل‌ها را به دانلود قسمت (Episode) اول محدود می‌کند تا روند آزمایش سیستم سریع‌تر انجام شود.
- فایل‌های دانلود شده توسط سیستم مستقیماً در فولدر ساختارنیافته `storage/` ذخیره شده و آدرس‌دهی آن‌ها بر اساس الگوی `storage/courses/{course_slug}/...` مدیریت می‌شود.
